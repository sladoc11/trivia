<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>테슬람 테스터 v1.0</title>
    <style>
        /* 배경과 기본 스타일 */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #000, #1a1a3d);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 시작 화면 */
        #시작화면 { text-align: center; animation: fadeIn 2s ease-in; }
        #시작화면 h1 { font-size: 4em; text-transform: uppercase; color: #ff0033; text-shadow: 0 0 20px #ff0033, 0 0 40px #ff0066; animation: pulse 2s infinite; margin-bottom: 10px; }
        #시작화면 p { font-size: 2.5em; color: #fff; text-shadow: 0 0 10px #00ccff; margin-top: 0; }
        #시작버튼 { padding: 20px 40px; font-size: 1.5em; background: #ff0033; border: none; border-radius: 10px; color: #fff; cursor: pointer; box-shadow: 0 0 15px #ff0033; transition: transform 0.3s; }
        #시작버튼:hover { transform: scale(1.1); }

        /* 퀴즈 화면 */
        #퀴즈화면 { display: none; width: 90%; max-width: 800px; text-align: center; position: relative; }
        #배경비디오 { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; opacity: 0.5; }
        #질문 { font-size: 2em; margin: 20px 0; text-shadow: 0 0 10px #00ccff; }
        #선택지 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 0 20px; }
        .선택지버튼 { padding: 15px; font-size: 1.2em; background: rgba(255, 255, 255, 0.1); border: 2px solid #00ccff; border-radius: 10px; color: #fff; cursor: pointer; transition: all 0.3s; }
        .선택지버튼:hover { background: #00ccff; color: #000; }
        #타이머 { font-size: 1.5em; margin: 10px 0; color: #ffcc00; }
        #진행바 { width: 100%; height: 10px; background: #333; border-radius: 5px; margin: 20px 0; }
        #진행바채움 { height: 100%; background: #ff0033; width: 0%; border-radius: 5px; transition: width 0.5s; }

        /* 점수 화면 */
        #점수화면 { display: none; text-align: center; animation: fadeIn 2s ease-in; }
        #점수화면 h2 { font-size: 3em; color: #00ccff; text-shadow: 0 0 20px #00ccff; }
        #최종점수 { font-size: 4em; color: #ff0033; animation: pulse 2s infinite; }
        #등급 { font-size: 2em; margin: 20px 0; }
        #공유버튼, #다시하기버튼 { padding: 15px 30px; font-size: 1.2em; background: #ff0033; border: none; border-radius: 10px; color: #fff; cursor: pointer; margin: 10px; box-shadow: 0 0 15px #ff0033; }

        /* 애니메이션 */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <!-- 시작 화면 -->
    <div id="시작화면">
        <h1>테슬람 테스터 v1.0</h1>
        <p>당신은 진정한 테슬람인가요? 한번 도전해 보세요!</p>
        <button id="시작버튼">퀴즈 시작</button>
    </div>

    <!-- 퀴즈 화면 -->
    <div id="퀴즈화면">
        <video id="배경비디오" autoplay loop muted>
            <source src="https://example.com/tesla-bg.mp4" type="video/mp4">
        </video>
        <div id="질문"></div>
        <div id="타이머">시간: 15초</div>
        <div id="선택지"></div>
        <div id="진행바"><div id="진행바채움"></div></div>
    </div>

    <!-- 점수 화면 -->
    <div id="점수화면">
        <h2>게임 종료!</h2>
        <div id="최종점수"></div>
        <div id="등급"></div>
        <button id="공유버튼">X에 공유</button>
        <button id="다시하기버튼">다시 플레이</button>
    </div>

    <!-- 질문 뱅크 로드 -->
    <script src="questions.js"></script>
    <!-- 게임 로직 -->
    <script>
        // 질문 뱅크 로드 확인
        if (typeof 질문뱅크 === 'undefined') {
            console.error('questions.js가 로드되지 않았습니다!');
            alert('질문 뱅크를 로드할 수 없습니다. questions.js 파일을 확인하세요.');
        } else {
            console.log('질문 뱅크가 성공적으로 로드되었습니다. 질문 수: ' + 질문뱅크.length);
        }

        // 전체 질문 뱅크 설정
        const 전체질문뱅크 = 질문뱅크.map(질문 => ({ ...질문 }));

        // 게임 변수
        let 현재질문 = 0;
        let 점수 = 0;
        let 타이머;
        const 게임당질문수 = 10;
        let 선택된질문들 = [];
        let 사용가능질문들 = JSON.parse(localStorage.getItem('사용가능질문들')) || 전체질문뱅크.slice();

        // 질문 풀 초기화
        if (사용가능질문들.length === 전체질문뱅크.length) {
            사용가능질문들 = 전체질문뱅크.slice();
            localStorage.setItem('사용가능질문들', JSON.stringify(사용가능질문들));
        }

        // DOM 요소 가져오기
        const 시작화면 = document.getElementById('시작화면');
        const 퀴즈화면 = document.getElementById('퀴즈화면');
        const 점수화면 = document.getElementById('점수화면');
        const 시작버튼 = document.getElementById('시작버튼');
        const 질문요소 = document.getElementById('질문');
        const 선택지요소 = document.getElementById('선택지');
        const 타이머요소 = document.getElementById('타이머');
        const 진행바채움 = document.getElementById('진행바채움');
        const 최종점수요소 = document.getElementById('최종점수');
        const 등급요소 = document.getElementById('등급');
        const 공유버튼 = document.getElementById('공유버튼');
        const 다시하기버튼 = document.getElementById('다시하기버튼');

        // 이벤트 리스너 추가
        console.log('시작 버튼에 이벤트 리스너를 추가합니다.');
        시작버튼.addEventListener('click', 퀴즈시작);
        다시하기버튼.addEventListener('click', 초기화하고시작);
        공유버튼.addEventListener('click', 점수공유);

        // 퀴즈 시작 함수
        function 퀴즈시작() {
            console.log('퀴즈시작 함수 호출됨');
            시작화면.style.display = 'none';
            퀴즈화면.style.display = 'block';
            선택된질문들 = 무작위질문가져오기();
            질문불러오기();
        }

        // 무작위 질문 가져오기 함수
        function 무작위질문가져오기() {
            console.log('무작위 질문 가져오기 시작');
            if (사용가능질문들.length < 게임당질문수) {
                console.log('질문 풀이 부족해 초기화합니다!');
                사용가능질문들 = 전체질문뱅크.slice();
            }

            const 섞인질문들 = 사용가능질문들.sort(() => 0.5 - Math.random());
            const 선택됨 = 섞인질문들.slice(0, 게임당질문수).map(질문 => {
                const 선택지 = 질문.선택지.slice().sort(() => 0.5 - Math.random());
                return { ...질문, 선택지 };
            });

            선택됨.forEach(질문 => {
                const 인덱스 = 사용가능질문들.findIndex(사용질문 => 사용질문.질문 === 질문.질문);
                if (인덱스 !== -1) 사용가능질문들.splice(인덱스, 1);
            });
            localStorage.setItem('사용가능질문들', JSON.stringify(사용가능질문들));
            console.log(`남은 질문 수: ${사용가능질문들.length}`);

            return 선택됨;
        }

        // 질문 불러오기 함수
        function 질문불러오기() {
            console.log(`질문 ${현재질문 + 1} 불러오기`);
            const 질문 = 선택된질문들[현재질문];
            질문요소.textContent = 질문.질문;
            선택지요소.innerHTML = '';
            질문.선택지.forEach(선택 => {
                const 버튼 = document.createElement('button');
                버튼.textContent = 선택;
                버튼.classList.add('선택지버튼');
                버튼.addEventListener('click', () => 정답확인(선택));
                선택지요소.appendChild(버튼);
            });
            진행바채움.style.width = `${((현재질문 + 1) / 게임당질문수) * 100}%`;
            타이머시작();
        }

        // 타이머 시작 함수
        function 타이머시작() {
            let 남은시간 = 15;
            타이머요소.textContent = `시간: ${남은시간}초`;
            타이머 = setInterval(() => {
                남은시간--;
                타이머요소.textContent = `시간: ${남은시간}초`;
                if (남은시간 <= 0) {
                    clearInterval(타이머);
                    다음질문();
                }
            }, 1000);
        }

        // 정답 확인 함수
        function 정답확인(선택) {
            clearInterval(타이머);
            const 질문 = 선택된질문들[현재질문];
            if (선택 === 질문.정답) {
                점수++;
            }
            다음질문();
        }

        // 다음 질문 함수
        function 다음질문() {
            현재질문++;
            if (현재질문 < 게임당질문수) {
                질문불러오기();
            } else {
                점수보여주기();
            }
        }

        // 점수 보여주기 함수
        function 점수보여주기() {
            퀴즈화면.style.display = 'none';
            점수화면.style.display = 'block';
            최종점수요소.textContent = `${점수}/${게임당질문수}`;
            let 등급 = '';
            if (점수 === 10) 등급 = "루디크러스 모드의 제왕";
            else if (점수 >= 8) 등급 = "일론의 오른팔";
            else if (점수 >= 6) 등급 = "인증된 테슬람";
            else if (점수 >= 4) 등급 = "테슬람 흉내쟁이";
            else if (점수 >= 2) 등급 = "트로이 테스라이크의 조수";
            else 등급 = "고든 존슨의 화장실 휴지";
            등급요소.textContent = `등급: ${등급}`;
            console.log(`게임 종료! 점수: ${점수}, 등급: ${등급}`);
        }

        // 점수 공유 함수
        function 점수공유() {
            const 텍스트 = `테슬람 테스터 v1.0에서 ${점수}/${게임당질문수}점을 얻었어요! 등급: ${등급요소.textContent.split(': ')[1]}. 지금 플레이: https://sladoc11.github.io/trivia/`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(텍스트)}`);
        }

        // 초기화하고 시작 함수
        function 초기화하고시작() {
            사용가능질문들 = 전체질문뱅크.slice();
            localStorage.setItem('사용가능질문들', JSON.stringify(사용가능질문들));
            점수 = 0;
            현재질문 = 0;
            점수화면.style.display = 'none';
            퀴즈시작();
        }
    </script>
</body>
</html>